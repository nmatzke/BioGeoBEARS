tree_string = "(((((((((((((((((Acrophyseter_deinodon:5.851170706,Acrophyseter_robustus:0.3659919293):3.414038214,Zygophyseter_varolai:5.731169065):7.413967091,(Livyatan_melvillei:12.85147387,(((((Aprixokogia_kelloggi:6.91017152,((((((Kogia_breviceps:4.054551716,Kogia_sima:4.054551716):3.242680169,Kogia_pusilla:4.252478566):0.06428598094,Koristocetus_pescei:0.04306105655):0.1899991033,Praekogia_cedrosensis:0.6153347735):1.409509004,Nanokogia_isthmia:1.403130405):0.4371193652,Scaphokogia_cochlearis:0.7769303758):1.209374538):7.811594276,((Aulophyseter_morricei:1e-07,Physeter_macrocephalus:15.47079151):1.759579066,Idiophyseter_merriami:3.390339982):1.188743582):0.1522519824,Orycterocetus_crocodilinus:3.141958593):3.591165987,Diaphorocetus_poucheti:0.5050962685):0.07695916008,Brygmophyseter_shigensis:6.863487275):0.584926051):0.02133925861):4.997449688,((((((((((((Africanacetus_ceratopsis:5.057226291,Mesoplodon_slangkopi:2.316223688):0.4873781419,(Mesoplodon_carlhubbsi:11.14981424,(Mesoplodon_peruvianus:5.591662281,(Mesoplodon_perrini:4.674588664,Mesoplodon_stejnegeri:4.674588663):0.9170736172):5.558151961):4.500946401):0.7925582758,Pterocetus_benguelae:2.05522793):0.05442362733,Xhosacetus_hendeysi:2.878798698):0.2858059006,(Izikoziphius_angustus:3.096076768,Ziphius_cavirostris:10.53583664):6.247711806):1.330577133,Nazcacetus_urbinai:10.73555948):1.685339444,((Archaeoziphius_microglenoideus:1e-07,Berardius_bairdii:14.48478779):1.131958306,Microberardius_africanus:3.126558827):4.18271893):1.526278185,Chavinziphius_maxillocristatus:14.47970843):5.310198831,(((((Globicetus_hiberus:0.1596252234,(Tusciziphius_atlanticus:0.6299372244,Tusciziphius_crispus:1.328385016):0.1051398573):20.85279834,(Choneziphius_leidyi:20.0291373,Choneziphius_planirostris:16.99480596):0.8722023388):0.2640178068,Ziphirostrum_marginatum:17.58462925):0.102857266,Messapicetus_gregarius:17.72822832):0.02122293929,(Chimuziphius_coloradensis:2.383462912,Notoziphius_bruneti:1e-07):16.9704566):0.01730302406):0.1166159039,Ninoziphius_platyrostris:22.70257021):0.05063445017,(((((((Albireo_whistleri:6.071848169,((((((Semirostrum_ceruttii:0.3968882637,Miophocaena_nishinoi:1e-07):0.6555507941,(Brabocetus_gigaseorum:2.244993354,((Haborophocoena_minutus:1e-07,Haborophocoena_toyoshimai:0.3163477427):1.767017332,Septemtriocetus_bosselaersi:2.581457572):0.1269533888):0.4544141844):3.28062821,(((Australithax_intermedia:1e-07,Lomacetus_ginsburgi:0.818312577):0.5869755795,Piscolithax_boreios:1.751274703):0.3721242949,((((Neophocaena_phocaenoides:5.945536084,((Phocoena_dioptrica:3.670522731,Phocoena_phocoena:3.670522731):0.7399161054,(Phocoena_sinus:4.00793441,Phocoena_spinipinnis:4.00793441):0.4025044263):1.535097247):0.04406090314,Piscolithax_longirostris:1e-07):1.160952568,Piscolithax_tedfordi:1e-07):0.200591293,Salumiphocaena_stocktoni:1.278073583):2.015292069):0.2492020627):0.2174967279,Pterophocaena_nishinoi:1e-07):0.3823301384,(((((Bohaskaia_monodontoides:1e-07,Monodon_monoceros:4.257365126):1.119074047,(Casatia_thermophila:0.2471053797,Delphinapterus_leucas:4.794510063):0.5819291101):0.1580579658,Odobenocetops_peruvianus:1e-07):0.2265916319,Denebola_brachycephala:1e-07):3.624454721,Haborodelphis_japonicus:4.857375818):0.8299183537):2.469101399,((((((((((((Delphinus_delphis:1.361521715,Stenella_coeruleoalba:1.361521715):0.7032130676,Tursiops_truncatus:2.064734783):1.198912948,Stenella_attenuata:3.263647731):0.02348828863,Stenella_longirostris:3.28713602):1.004827083,Etruridelphis_giulii:1.585783532):0.562068299,Sousa_chinensis:4.854031402):0.7947398574,Sotalia_fluviatilis:5.648771259):0.8185089228,(((((Feresa_attenuata:3.257631625,Peponocephala_electra:3.257631625):0.03802371171,(Globicephala_macrorhynchus:2.705648713,Protoglobicephala_mexicana:1e-07):0.590006623):0.2928082272,Grampus_griseus:3.588463564):0.6571111349,Pseudorca_crassidens:4.245574699):2.062173771,Steno_bredanensis:6.30774847):0.1595317122):0.404791953,Lagenorhynchus_albirostris:6.872072135):0.1042546153,Lissodelphis_borealis:6.976326751):0.1282208944,(Hemisyntrachelus_cortesii:1e-07,Orcinus_orca:2.750096459):4.354451186):1.070214211,Eodelphinus_kabatensis:1e-07):4.509801388):0.4347794798):3.813978388,(((Atocetus_iquensis:1e-07,Atocetus_nasalis:3.18458476):1.172283756,Tagicetus_joneti:1e-07):2.079560094,(Lophocetus_calvertensis:1e-07,Lophocetus_repenningi:0.1346338492):6.450523546):1.48664603):0.943585192,Liolithax_pappus:3.417008008):0.2607371181,(Kentriodon_diusinus:1.404764136,(((Kentriodon_nakajimai:2.756416376,Kentriodon_obscurus:0.1973787507):1.020211795,Kentriodon_pernix:1e-07):0.5895311089,Kentriodon_schneideri:1e-07):1.293870187):1.077955713):1.544631154,((Hadrodelphis_calvertense:1.56662537,Macrokentriodon_morani:3.930348363):3.068235759,Wimahl_chinookensis:2.456511559):0.4841833295):1.769490725,(((((Brujadelphis_ankylorostris:1e-07,Scaldiporia_vandokkumi:0.5566289874):0.3118446959,Isthminia_panamensis:5.698920622):1.006656958,(Inia_geoffrensis:6.026457766,Kwanzacetus_khoisani:1e-07):6.989776849):3.136683972,((Brachydelphis_jahuayensis:0.6794515094,Brachydelphis_mazeasi:1e-07):0.7011740074,Pliopontos_littoralis:2.382369595):6.619185723):2.802591025,(Lipotes_vexillifer:9.045870055,Parapontoporia_sternbergi:6.259970265):9.909639557):2.49625569):0.07005894369,Delphinodon_dividum:1e-07):5.281368147):0.2040566755,((Allodelphis_pratti:1.355018974,((((Araeodelphis_natator:3.799688097,(Dilophodelphis_fordycei:1e-07,(Platanista_gangetica:16.13455132,(Pomatodelphis_inaequalis:1.695854442,Zarhachis_flagellator:1e-07):2.088264071):0.7079299013):5.468850434):1.600982131,((Huaridelphis_raimondii:0.7904872633,Notocetus_vanbenedeni:1e-07):4.54978746,Macrosqualodelphis_ukupachai:4.000625162):1.178403246):0.01899795318,Ninjadelphis_ujiharai:6.606938469):0.5419086666,(Goedertius_oregonensis:1.699511315,Zarhinocetus_errabundus:7.24819394):1.328416846):0.2726329372):0.7217156024,Arktocara_yakataga:2.331117845):1.539680123):0.8359572124):0.1283140691,(Squaloziphius_emlongi:0.3058142783,Yaquinacetus_meadi:1e-07):5.605049515):0.5494508779,(Argyrocetus_bakersfieldensis:0.1900810889,(Chilcacetus_cavirhinus:0.369257369,Inticetus_vertizi:0.4447292196):5.933825146):2.273875611):1.798929885,((Aondelphis_talen:8.616447765,((Waipatia_hectori:0.1522599017,Waipatia_maerewhenua:1e-07):0.9857273966,(Otekaikea_huata:1e-07,Otekaikea_marplesi:3.338697542):1.436226213):0.0963913856):1.780525837,(Prosqualodon_davidis:7.073763098,((Prosqualodon_australis:1.346345609,Squalodon_calvertensis:1e-07):4.639588379,Phoberodon_arctirostris:5.826493397):3.185344171):1.258086741):0.2802441733):0.6425741667,Patriocetus_kazakhstanicus:3.678954433):0.271575329,Agorophius_pygmaeus:4.274310531):0.6402015574,Simocetus_rayi:0.3003619187):1.92169756,Olympicetus_avitus:6.667048165):2.608690084,(((((Albertocetus_meffordorum:1e-07,(Cotylocara_macei:0.2588817692,Echovenator_sandersi:1.287442118):0.8276364552):0.5815256375,Xenorophus_sloanii:0.498968082):3.191959598,Archaeodelphis_patrius:7.241199155):0.6342268553,Mirocetus_riabinini:0.2868650337):0.6063521034,Ashleycetus_planicapitis:1.371251441):2.273305916):0.7787856007,((((((((((Aetiocetus_cotylalveus:2.283999877,Aetiocetus_polydentatus:1e-07):0.3177137408,Aetiocetus_weltoni:0.6195755198):3.071245671,(Fucaia_buelli:1e-07,Fucaia_goedertorum:3.29978882):0.1988829685):0.9254922624,(Chonecetus_sookensis:0.04224331827,Morawanocetus_yabukii:1e-07):5.689067866):0.02372307618,Salishicetus_meadi:7.130711824):1.250657658,(((((((((((Isanacetus_laticephalus:0.02291560662,((Diorocetus_chichibuensis:1.715723224,Parietobalaena_yamaokai:1e-07):1.757569942,((Parietobalaena_palmeri:0.3500403606,Tiphyocetus_temblorensis:1.071289124):0.1086862238,Parietobalaena_campiniana:2.440290254):1.495007724):0.3125479221):3.225584761,Diorocetus_shobarensis:3.160170934):0.1063047528,(Pelocetus_calvertensis:2.030549604,Uranocetus_gramensis:6.469722918):4.316765001):0.3158864531,(Diorocetus_hiatus:0.05044982759,Thinocetus_arthritus:2.189961944):7.440988059):0.3573259222,((((Parabalaenoptera_baulinensis:5.225249945,Balaenoptera_bertae:7.609173494):0.650576652,((Eschrichtius_robustus:5.222818338,Gricetoides_aurorae:1.321797741):5.598866379,((((Balaenoptera_borealis:3.884413512,Balaenoptera_omurai:3.884413512):5.071264987,Balaenoptera_musculus:8.955678498):0.310673756,Diunatans_luctoretemergo:5.297958923):0.6072593448,(Balaenoptera_physalus:6.515807168,Megaptera_novaeangliae:6.515807168):3.357804431):0.9480731188):0.8249863359):1.109495105,Balaenoptera_acutorostrata:12.75616616):0.3641460155,Norrisanima_miocaena:5.686920217):9.583821051):0.4084509526,Cophocetus_oregonensis:3.687826808):1.806143747,((((Metopocetus_durinasus:0.7382225025,(((Herpetocetus_bramblei:1e-07,Herpetocetus_morrowi:1.805290771):1.727386391,Herpetocetus_transatlanticus:2.100009483):2.072063774,Nannocetus_eremus:2.596165533):6.507091201):2.17249168,(Cetotherium_megalophysum:1.026882877,Mixocetus_elysius:1e-07):5.702468421):0.956789756,(Caperea_marginata:10.7876614,Cephalotropis_coronatus:1e-07):7.242331119):0.6097355177,Joumocetus_shimizui:8.446093144):6.278999887):1.769249371,(((((Balaena_mysticetus:4.396994237,Balaena_ricei:1e-07):2.866481047,((Eubalaena_ianitrix:0.1052995198,Eubalaena_japonica:3.226348915):2.492734625,Eubalaena_shinshuensis:1e-07):1.544391743):0.7530950942,Balaenella_brachyrhynus:3.683046263):8.425287883,Peripolocetus_vexillifer:0.9104038327):0.6071762466,Morenocetus_parvus:1e-07):9.63894279):0.949950612,Horopeta_umarere:1.688314836):2.776973425,(((Eomysticetus_whitmorei:0.7789677777,Yamatocetus_canaliculatus:1e-07):0.2042038421,(Waharoa_ruwhenua:0.2932270871,(Tokarahia_kauaeroa:0.108640878,Tokarahia_lophocephalus:1e-07):1.083329192):1.379881252):0.1894160027,Micromysticetus_rothauseni:1e-07):1.583618954):3.19351912,(Maiabalaena_nesbittae:1e-07,Sitsqwayk_cornishorum:4.904855606):1.533631529):0.002993456809):0.1019862489,Borealodon_osedax:3.462555755):0.04483503541,(Janjucetus_hunderi:0.9849951436,Mammalodon_colliveri:4.524191569):4.860928935):0.02653751086,Coronodon_havensteini:3.535522334):2.175256625,(Llanocetus_denticrenatus:1e-07,Mystacodon_selenensis:1.123198577):0.6608981872):1.22339608):1.935350022,((Basilosaurus_isis:2.304110283,Cynthiacetus_peruvianus:1.269560726):0.2481654064,Dorudon_atrox:2.973440433):1.161639936):8.144866258,Rodhocetus_kasranii:5.04074003):1.043424986,Maiacetus_inuus:3.017386146):3.032548798,Pakicetus_attocki:7.5619984):0;"


#get total branchlength by time period
library(ape)
library(BioGeoBEARS)

# Or set the timeperiods manually
timeperiods = c(0.012, 2.58, 5.333, 23.03, 33.9, 56)

# Load tree from file

#trfn = "Cetacea_Safe_MAP_sub463B.newick"
tr = read.tree(file=NULL, text=tree_string)

# Run the function
counts_df = sum_nodes_branchlengths_by_timeperiod(tr, timeperiods)
counts_df

# Check that the sums add up
sum(tr$edge.length)
sum(counts_df$branchlength_sums)

tr$Nnode
sum(counts_df$node_counts)


